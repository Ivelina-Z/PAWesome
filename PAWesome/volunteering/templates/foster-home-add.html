{% extends 'base.html'%}

{% block styles %}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
         integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
         crossorigin=""/>
{% endblock styles %}

{% block content %}
    <h1>Стани приемен дом</h1>
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <div id="location_map" style="height: 500px;"></div>
        <button type="submit">Изпрати</button>
    </form>
{% endblock content %}

{% block js-scripts %}
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script>
        function initMap() {
            let map = L.map('location_map').setView([42.930, 26.027], 7);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            }).addTo(map);

            function onClick(event) {
                let mapBlock = document.getElementById('location_map');
                let coordinates = event.latlng;
                const inputField = document.getElementById('id_location')
                inputField.value = `POINT (${coordinates.lat} ${coordinates.lng})`;
                console.log(inputField.value);
            }
            map.on('click', onClick);
        }
        window.addEventListener('DOMContentLoaded', (event) => {
            initMap();
        });
    </script>
{% endblock js-scripts %}
